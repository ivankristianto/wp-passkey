{"version":3,"file":"login-469c2d44.js","sources":["../../src/js/login.js"],"sourcesContent":["import { browserSupportsWebAuthn, browserSupportsWebAuthnAutofill, startAuthentication } from '@simplewebauthn/browser';\nimport apiFetch from '@wordpress/api-fetch';\nimport domReady from '@wordpress/dom-ready';\n\n/**\n * Authenticate Passkey.\n */\nasync function authenticate() {\n\tlet asseResp;\n\tlet requestId;\n\ttry {\n\t\tconst response = await apiFetch( {\n\t\t\tpath: '/wp-passkey/v1/signin-request',\n\t\t\tmethod: 'POST',\n\t\t} );\n\n\t\tconst { options, request_id } = response;\n\n\t\trequestId = request_id;\n\t\tasseResp = await startAuthentication( options );\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n\n\t// POST the response to the endpoint that calls.\n\ttry {\n\t\tconst response = await apiFetch( {\n\t\t\tpath: '/wp-passkey/v1/signin-response',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\trequest_id: requestId,\n\t\t\t\tasseResp,\n\t\t\t},\n\t\t} );\n\n\t\tif ( response.status !== 'verified' ) {\n\t\t\tthrow new Error( 'Passkey authentication failed.' );\n\t\t}\n\n\t\t// Get redirect_to from query string.\n\t\tconst urlParams = new URLSearchParams( window.location.search );\n\t\tconst redirect_to = urlParams.get( 'redirect_to' ) || '/wp-admin';\n\n\t\t// Redirect to redirect url or wp-admin as default.\n\t\twindow.location.href = redirect_to;\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n}\n\n/**\n * Show error message.\n *\n * @param {string} message Error message.\n */\nfunction showError( message ) {\n\tconst loginForm = document.getElementById( 'loginform' );\n\n\t// Create Error element if not exists.\n\tconst errorElement = document.createElement( 'div' );\n\terrorElement.id = 'login_error';\n\terrorElement.className = 'notice notice-error';\n\terrorElement.innerHTML = message;\n\n\t// Add error element before login form.\n\tloginForm.parentNode.insertBefore( errorElement, loginForm );\n\n\tloginForm.classList.add( 'shake' );\n}\n\ndomReady( async () => {\n\t// If the browser doesn't support WebAuthn, don't do anything.\n\tif ( ! browserSupportsWebAuthn() ) {\n\t\treturn;\n\t}\n\n\tconst usernameField = document.getElementById( 'user_login' );\n\n\t// add autocomplete=\"webauthn\" to the username field.\n\tif ( usernameField ) {\n\t\tusernameField.setAttribute( 'autocomplete', 'username webauthn' );\n\t}\n\n\tif ( browserSupportsWebAuthnAutofill() ) {\n\t\ttry {\n\t\t\tawait authenticate();\n\t\t} catch ( error ) {\n\t\t\tshowError( error.message );\n\t\t}\n\t}\n} );\n"],"names":["authenticate","asseResp","requestId","response","options","request_id","startAuthentication","error","redirect_to","showError","message","loginForm","errorElement","browserSupportsWebAuthn","usernameField","browserSupportsWebAuthnAutofill"],"mappings":"sDAOA,eAAAA,GAAA,CACA,IAAAC,EACAC,EACA,GAAA,CACA,MAAAC,EAAA,MAAyB,GAAQ,SAAA,CACjC,KAAA,gCACA,OAAA,MACA,GAEA,CAAA,QAAAC,EAAA,WAAAC,CAAA,EAAAF,EAEAD,EAAAG,EACAJ,EAAA,MAAAK,EAAAF,EACA,OAAAG,EAAA,CACA,MAAAA,CACA,CAGA,GAAA,CAUA,IATA,MAAyB,GAAQ,SAAA,CACjC,KAAA,iCACA,OAAA,OACA,KAAA,CACA,WAAAL,EACA,SAAAD,CACA,CACA,IAEA,SAAA,WACA,MAAA,IAAA,MAAA,kCAKA,MAAAO,EADA,IAAA,gBAAA,OAAA,SAAA,MAAA,EACA,IAAA,aAAA,GAAA,YAGA,OAAA,SAAA,KAAAA,CACA,OAAAD,EAAA,CACA,MAAAA,CACA,CACA,CAOA,SAAAE,EAAAC,EAAA,CACA,MAAAC,EAAA,SAAA,eAAA,WAAA,EAGAC,EAAA,SAAA,cAAA,KAAA,EACAA,EAAA,GAAA,cACAA,EAAA,UAAA,sBACAA,EAAA,UAAAF,EAGAC,EAAA,WAAA,aAAAC,EAAAD,CAAA,EAEAA,EAAA,UAAA,IAAA,QACA,CAEA,GAAQ,SAAA,SAAA,CAER,GAAA,CAAAE,EAAA,EACA,OAGA,MAAAC,EAAA,SAAA,eAAA,YAAA,EAOA,GAJAA,GACAA,EAAA,aAAA,eAAA,qBAGAC,EAAA,EACA,GAAA,CACA,MAAAf,EAAA,CACA,OAAAO,EAAA,CACAE,EAAAF,EAAA,QACA,CAEA,CAAA"}