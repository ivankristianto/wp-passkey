{"version":3,"file":"user-profile-1dc68691.js","sources":["../../src/js/user-profile.js"],"sourcesContent":["import { browserSupportsWebAuthn, startRegistration } from '@simplewebauthn/browser';\nimport apiFetch from '@wordpress/api-fetch';\nimport domReady from '@wordpress/dom-ready';\nimport { __ } from '@wordpress/i18n';\n\nimport '../scss/user-profile.scss';\n\n/**\n * Create Passkey Registration.\n */\nasync function createRegistration() {\n\tlet attResp;\n\n\ttry {\n\t\tconst response = await apiFetch( {\n\t\t\tpath: '/wp-passkey/v1/register-request',\n\t\t\tmethod: 'POST',\n\t\t} );\n\n\t\tattResp = await startRegistration( response );\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n\n\t// POST the response to the endpoint that calls.\n\ttry {\n\t\tconst response = await apiFetch( {\n\t\t\tpath: '/wp-passkey/v1/register-response',\n\t\t\tmethod: 'POST',\n\t\t\tdata: attResp,\n\t\t} );\n\n\t\tif ( response.status === 'verified' ) {\n\t\t\twindow.location.reload();\n\t\t}\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n}\n\n/**\n * Passkey Registration Handler.\n */\ndomReady( () => {\n\tconst registerButton = document.querySelector( '.wp-register-new-passkey' );\n\tconst registerMessage = document.querySelector( '.wp-register-passkey--message' );\n\n\tif ( ! registerButton || ! registerMessage ) {\n\t\treturn;\n\t}\n\n\t// Hide register button if browser doesn't support WebAuthn.\n\tif ( ! browserSupportsWebAuthn() ) {\n\t\tregisterButton.style.display = 'none';\n\t\treturn;\n\t}\n\n\tregisterButton.addEventListener( 'click', async () => {\n\t\ttry {\n\t\t\tawait createRegistration();\n\t\t} catch ( error ) {\n\t\t\t// Some basic error handling\n\t\t\tif ( error.name === 'InvalidStateError' ) {\n\t\t\t\tregisterMessage.innerText = __(\n\t\t\t\t\t'Error: Authenticator was probably already registered by you',\n\t\t\t\t\t'biometric-authentication',\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tregisterMessage.innerText = `Error: ${ error.message }`;\n\t\t\t}\n\t\t\tregisterMessage.classList.add( 'error' );\n\t\t}\n\t} );\n} );\n\n/**\n * Revoke Passkey.\n *\n * @param {Event} event The event.\n */\nasync function revokePasskey( event ) {\n\tevent.preventDefault();\n\n\tif (\n\t\t// eslint-disable-next-line no-alert\n\t\t! window.confirm(\n\t\t\t__( 'Are you sure you want to revoke this passkey? This action cannot be undone.', 'biometric-authentication' ),\n\t\t)\n\t) {\n\t\treturn;\n\t}\n\n\tconst revokeButton = event.target;\n\tconst fingerprint = revokeButton.dataset.id;\n\n\ttry {\n\t\tconst response = await apiFetch( {\n\t\t\tpath: '/wp-passkey/v1/revoke',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tfingerprint,\n\t\t\t},\n\t\t} );\n\n\t\tif ( response.status === 'success' ) {\n\t\t\twindow.location.reload();\n\t\t}\n\t} catch ( error ) {\n\t\tthrow error;\n\t}\n}\n\n/**\n * Passkey Revoke handler.\n */\ndomReady( () => {\n\tconst revokeButtons = document.querySelectorAll( '.wp-passkey-list-table button.delete' );\n\n\tif ( ! revokeButtons ) {\n\t\treturn;\n\t}\n\n\trevokeButtons.forEach( revokeButton => {\n\t\trevokeButton.addEventListener( 'click', revokePasskey );\n\t} );\n} );\n"],"names":["createRegistration","attResp","response","startRegistration","error","registerButton","registerMessage","browserSupportsWebAuthn","revokePasskey","event","fingerprint","revokeButtons","revokeButton"],"mappings":"+CAUA,eAAAA,GAAA,CACA,IAAAC,EAEA,GAAA,CACA,MAAAC,EAAA,MAAyB,GAAQ,SAAA,CACjC,KAAA,kCACA,OAAA,MACA,GAEAD,EAAA,MAAAE,EAAAD,EACA,OAAAE,EAAA,CACA,MAAAA,CACA,CAGA,GAAA,EACA,MAAyB,GAAQ,SAAA,CACjC,KAAA,mCACA,OAAA,OACA,KAAAH,CACA,IAEA,SAAA,YACA,OAAA,SAAA,QAEA,OAAAG,EAAA,CACA,MAAAA,CACA,CACA,CAKA,GAAQ,SAAA,IAAA,CACR,MAAAC,EAAA,SAAA,cAAA,0BAAA,EACAC,EAAA,SAAA,cAAA,+BAAA,EAEA,GAAA,GAAAD,GAAA,CAAAC,GAKA,IAAA,CAAAC,EAAA,EAAA,CACAF,EAAA,MAAA,QAAA,OACA,MACA,CAEAA,EAAA,iBAAA,QAAA,SAAA,CACA,GAAA,CACA,MAAAL,EAAA,CACA,OAAAI,EAAA,CAEAA,EAAA,OAAA,oBACAE,EAAA,UAAgC,GAAE,KAAA,GAClC,8DACA,0BACA,EAEAA,EAAA,UAAA,UAAAF,EAAA,OAAA,GAEAE,EAAA,UAAA,IAAA,QACA,CACA,GACA,GAOA,eAAAE,EAAAC,EAAA,CAGA,GAFAA,EAAA,eAAA,EAIA,CAAA,OAAA,QACG,GAAE,KAAA,GAAA,8EAAA,0BAAA,CACL,EAEA,OAIA,MAAAC,EADAD,EAAA,OACA,QAAA,GAEA,GAAA,EACA,MAAyB,GAAQ,SAAA,CACjC,KAAA,wBACA,OAAA,OACA,KAAA,CACA,YAAAC,CACA,CACA,IAEA,SAAA,WACA,OAAA,SAAA,QAEA,OAAAN,EAAA,CACA,MAAAA,CACA,CACA,CAKA,GAAQ,SAAA,IAAA,CACR,MAAAO,EAAA,SAAA,iBAAA,sCAAA,EAEAA,GAIAA,EAAA,QAAAC,GAAA,CACAA,EAAA,iBAAA,QAAAJ,EACA,EACA,CAAA"}